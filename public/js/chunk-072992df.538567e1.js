(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-072992df"],{"630f":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cs-p"},[a("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[e.auth.add?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",disabled:e.loading},on:{click:function(t){return e.handleCreate("create")}}},[e._v("新增顶层权限")])],1):e._e(),a("el-form-item",[a("el-button-group",[e.auth.enable?a("el-button",{attrs:{icon:"el-icon-check",disabled:e.loading},on:{click:function(t){return e.setStatusList(1)}}},[e._v("启用")]):e._e(),e.auth.disable?a("el-button",{attrs:{icon:"el-icon-close",disabled:e.loading},on:{click:function(t){return e.setStatusList(0)}}},[e._v("禁用")]):e._e()],1)],1),a("el-form-item",[a("el-button-group",[a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",disabled:e.loading},on:{click:function(t){return e.checkedNodes(!0)}}},[e._v("展开")]),a("el-button",{attrs:{icon:"el-icon-remove-outline",disabled:e.loading},on:{click:function(t){return e.checkedNodes(!1)}}},[e._v("收起")])],1)],1),e.auth.del?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-delete",disabled:e.loading},on:{click:e.removeList}},[e._v("删除")])],1):e._e(),a("el-form-item",{attrs:{label:"过滤"}},[a("el-input",{staticStyle:{width:"240px"},attrs:{disabled:e.loading,placeholder:"输入关键词进行过滤","prefix-icon":"el-icon-search",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),a("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:e.$route.path}})],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{span:10}},[e.hackReset?a("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"rule_id",data:e.treeData,props:e.treeProps,"filter-node-method":e.filterNode,"highlight-current":!0,"default-expand-all":e.isExpandAll,"default-expanded-keys":e.expanded,"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,draggable:!0,"show-checkbox":!0},on:{"node-click":e.handleNodeClick,"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node action"},[a("span",{staticClass:"brother-showing",class:{"status-tree":!o.status}},[!o.system&&e.auth.move?a("i",{staticClass:"el-icon-sort move-tree cs-mr-5"}):e._e(),o.children?a("i",{class:"el-icon-"+(s.expanded?"folder-opened":"folder")}):a("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(s.label)+" ")]),o.system?a("span",{staticClass:"active"},[e.auth.add?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.handleCreate("create",s.key)}}},[e._v(" 新增 ")]):e._e()],1):a("span",{staticClass:"active"},[e.auth.disable||e.auth.enable?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.setStatusItem(o.rule_id,o.status)}}},[e._v(" "+e._s(o.status?"禁用":"启用")+" ")]):e._e(),e.auth.del?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.remove([o.rule_id],!1)}}},[e._v(" 删除 ")]):e._e()],1)])}}],null,!1,501905714)}):e._e()],1),a("el-col",{attrs:{span:14}},[e.auth.add||e.auth.set?a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(e.formMap[e.formStatus]))]),"create"===e.formStatus&&e.auth.add?a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:e.formLoading},on:{click:e.create}},[e._v("确定")]):"update"===e.formStatus&&e.auth.set?a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:e.formLoading},on:{click:e.update}},[e._v("修改")]):e._e()],1),a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入权限名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"模块",prop:"module"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.module,callback:function(t){e.$set(e.form,"module",t)},expression:"form.module"}},e._l(e.module,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"用户组",prop:"group_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",value:""},model:{value:e.form.group_id,callback:function(t){e.$set(e.form,"group_id",t)},expression:"form.group_id"}},e._l(e.group,(function(e){return a("el-option",{key:e.group_id,attrs:{label:e.name,value:e.group_id}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:255,"controls-position":"right"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1)],1)],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}]},[a("el-collapse",[a("el-collapse-item",{attrs:{title:"菜单权限"}},[a("el-tree",{ref:"menuTree",attrs:{"node-key":"menu_id",data:e.menuData,props:e.treeProps,"default-checked-keys":e.form.menu_auth,"show-checkbox":!0},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{staticClass:"brother-showing",class:{"status-tree":!o.status}},[o.icon?a("i",{class:"iconfont icon"+o.icon}):o.children?a("i",{class:"el-icon-"+(s.expanded?"folder-opened":"folder")}):a("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(s.label)+" "),o.url?a("i",{staticClass:"el-icon-link"},[e._v(" "+e._s(o.url)+" ")]):e._e()])])}}],null,!1,2917250507)})],1),"api"===e.form.module?a("el-collapse-item",{attrs:{title:"记录权限"}},[a("el-tree",{ref:"logTree",attrs:{"node-key":"menu_id",data:e.menuData,props:e.treeProps,"default-checked-keys":e.form.log_auth,"show-checkbox":!0},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{staticClass:"brother-showing",class:{"status-tree":!o.status}},[o.icon?a("i",{class:"iconfont icon"+o.icon}):o.children?a("i",{class:"el-icon-"+(s.expanded?"folder-opened":"folder")}):a("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(s.label)+" "),o.url?a("i",{staticClass:"el-icon-link"},[e._v(" "+e._s(o.url)+" ")]):e._e()])])}}],null,!1,2917250507)})],1):e._e()],1)],1)],1):e._e()],1)],1)],1)},o=[],r=(a("a4d3"),a("99af"),a("4de4"),a("caad"),a("c975"),a("4e82"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("d3b7"),a("25f0"),a("159b"),a("2909")),n=a("ade3"),i=a("ca7e"),l=a("ca00"),u=a("a308");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={props:{loading:{default:!1},treeData:{default:function(){return[]}},module:{default:function(){}},group:{default:function(){}}},data:function(){return{hackReset:!0,isExpandAll:!0,expanded:[],filterText:"",treeLoading:!1,treeProps:{label:"name",children:"children"},auth:{add:!1,del:!1,set:!1,enable:!1,disable:!1,move:!1},form:{module:void 0,group_id:void 0,name:void 0,menu_auth:[],log_auth:[],sort:50,status:"1"},menuData:[],formStatus:"create",formLoading:!1,formMap:{create:"新增权限",update:"编辑权限"},menuAuth:[],logAuth:[],rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:32,message:"长度不能大于 32 个字符",trigger:"blur"}],module:[{required:!0,message:"至少选择一项",trigger:"change"}],group_id:[{required:!0,message:"至少选择一项",trigger:"change"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{filterText:function(e){this.$refs.tree.filter(e)},"form.module":{handler:function(e){this.switchModule(e)},deep:!0}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/system/auth/rule/add"),this.auth.del=this.$has("/system/auth/rule/del"),this.auth.set=this.$has("/system/auth/rule/set"),this.auth.enable=this.$has("/system/auth/rule/enable"),this.auth.disable=this.$has("/system/auth/rule/disable"),this.auth.move=this.$has("/system/auth/rule/move")},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},checkedNodes:function(e){var t=this;this.filterText="",this.expanded=[],this.hackReset=!1,this.$nextTick((function(){t.isExpandAll=e,t.hackReset=!0}))},remove:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var s=e.filter((function(e){return!t.module.hasOwnProperty(e)}));Object(i["b"])(s).then((function(){s.forEach((function(e){t.$refs.tree.remove(e)})),a&&t.$refs.tree.setCheckedKeys([]),t.handleCreate("create"),t.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},removeList:function(){this.remove(this.$refs.tree.getCheckedKeys(!0))},enable:function(e,t){var a=this,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var o=e.filter((function(e){return!a.module.hasOwnProperty(e)}));Object(i["f"])(o,t).then((function(){o.forEach((function(e){a.$refs.tree.getNode(e).data.status=t})),s&&a.$refs.tree.setCheckedKeys([]),a.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},setStatusList:function(e){this.enable(this.$refs.tree.getCheckedKeys(!0),e)},setStatusItem:function(e,t){this.enable([e],t?0:1,!1)},handleNodeClick:function(e){(this.auth.add||this.auth.set)&&(e.system?this.handleCreate("create",e.module):(this.resetForm(),this.resetElements("update"),this.menuAuth=e.menu_auth,this.logAuth=e.log_auth,this.form=d({},e,{status:e.status.toString()}),this.group.hasOwnProperty(this.form.group_id)||(this.form.group_id=void 0)))},allowDrag:function(e){return!this.module.hasOwnProperty(e.key)&&this.auth.move},allowDrop:function(e,t,a){return!(e.parent!==t.parent||"inner"===a)},handleDrop:function(e,t){var a=this,s=[];t.parent.childNodes.forEach((function(e,t){s.push(e.key),e.data.sort=t+1})),Object(i["d"])(s).catch((function(){a.$emit("refresh")}))},switchModule:function(e){var t=this;e?(this.treeLoading=!0,Object(u["d"])({module:e}).then((function(a){if(t.menuData=l["a"].formatDataToTree(a.data),"update"===t.formStatus&&a.data.length){if(!t.menuAuth.length&&!t.logAuth.length)return;var s=[];if(a.data.forEach((function(e){e["children_total"]<=0&&s.push(e.menu_id)})),!s.length)return;t.form.menu_auth=t.menuAuth.filter((function(e){return s.includes(e)})),"api"===e&&(t.form.log_auth=t.logAuth.filter((function(e){return s.includes(e)})))}})).finally((function(){t.treeLoading=!1}))):this.menuData=[]},resetForm:function(){this.form={module:"",group_id:"",name:"",menu_auth:[],log_auth:[],sort:50,status:"1"}},resetElements:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"create";this.$nextTick((function(){e.$refs.form.clearValidate()})),this.menuData=[],this.menuAuth=[],this.logAuth=[],this.formStatus=t,this.formLoading=!1},handleCreate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetForm(),this.resetElements(e),t&&(this.form.module=t)},_getCheckedKeys:function(){this.form.menu_auth=[].concat(Object(r["a"])(this.$refs.menuTree.getCheckedKeys()),Object(r["a"])(this.$refs.menuTree.getHalfCheckedKeys())),"api"===this.form.module&&(this.form.log_auth=[].concat(Object(r["a"])(this.$refs.logTree.getCheckedKeys()),Object(r["a"])(this.$refs.logTree.getHalfCheckedKeys())))},create:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.formLoading=!0,e._getCheckedKeys(),Object(i["a"])(d({},e.form)).then((function(){e.$emit("refresh"),e.$message.success("操作成功")})).catch((function(){e.formLoading=!1})))}))},update:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.formLoading=!0,e._getCheckedKeys(),Object(i["e"])(d({},e.form)).then((function(){e.$emit("refresh"),e.$message.success("操作成功")})).catch((function(){e.formLoading=!1})))}))}}},f=h,m=(a("72bd"),a("2877")),p=Object(m["a"])(f,s,o,!1,null,"055a8c67",null);t["default"]=p.exports},"72bd":function(e,t,a){"use strict";var s=a("9807"),o=a.n(s);o.a},9807:function(e,t,a){}}]);